(function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.nipplejs=e()}})(function(){function l(){}function c(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restOpacity:.5,mode:"dynamic",zone:document.body},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=c.id,c.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function h(e,t){var n=this;n.nipples=[],n.idles=[],n.actives=[],n.ids=[],n.pressureIntervals={},n.manager=e,n.id=h.id,h.id+=1,n.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restOpacity:.5},n.config(t);if(n.options.mode==="static"||n.options.mode==="semi")n.options.multitouch=!1;return n.options.multitouch||(n.options.maxNumberOfNipples=1),n.updateBox(),n.prepareNipples(),n.bindings(),n.begin(),n.nipples}function p(e){var t=this;t.ids={},t.index=0,t.collections=[],t.config(e),t.prepareCollections();var n;return f.bindEvt(window,"resize",function(e){clearTimeout(n),n=setTimeout(function(){var e,n=f.getScroll();t.collections.forEach(function(t){t.forEach(function(t){e=t.el.getBoundingClientRect(),t.position={x:n.x+e.left,y:n.y+e.top}})})},100)}),t.collections}var e,t,n;"use strict";var r="ontouchstart"in window,i=window.PointerEvent?!0:!1,s=window.MSPointerEvent?!0:!1,o={touch:{start:"touchstart",move:"touchmove",end:"touchend"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},u,a={};i?u=o.pointer:s?u=o.MSPointer:r?(u=o.touch,a=o.mouse):u=o.mouse;var f={};f.distance=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},f.angle=function(e,t){var n=t.x-e.x,r=t.y-e.y;return f.degrees(Math.atan2(r,n))},f.findCoord=function(e,t,n){var r={x:0,y:0};return n=f.radians(n),r.x=e.x-t*Math.cos(n),r.y=e.y-t*Math.sin(n),r},f.radians=function(e){return e*(Math.PI/180)},f.degrees=function(e){return e*(180/Math.PI)},f.bindEvt=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent(t,n)},f.unbindEvt=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n):e.detachEvent&&e.detachEvent(t,n)},f.trigger=function(e,t,n){var r=new CustomEvent(t,n);e.dispatchEvent(r)},f.prepareEvent=function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},f.getScroll=function(){var e=window.pageXOffset!==undefined?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==undefined?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},f.applyPosition=function(e,t){if(t.x&&t.y)e.style.left=t.x+"px",e.style.top=t.y+"px";else if(t.top||t.right||t.bottom||t.left)e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left},f.getTransitionStyle=function(e,t,n){var r=f.configStylePropertyObject(e);for(var i in r)if(r.hasOwnProperty(i))if(typeof t=="string")r[i]=t+" "+n;else{var s="";for(var o=0,u=t.length;o<u;o+=1)s+=t[o]+" "+n+", ";r[i]=s.slice(0,-2)}return r},f.getVendorStyle=function(e,t){var n=f.configStylePropertyObject(e);for(var r in n)n.hasOwnProperty(r)&&(n[r]=t);return n},f.configStylePropertyObject=function(e){var t={};t[e]="";var n=["webkit","Moz","o"];return n.forEach(function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},f.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},f.safeExtend=function(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?n[r]=t[r]:e.hasOwnProperty(r)&&(n[r]=e[r]);return n},f.map=function(e,t){if(e.length)for(var n=0,r=e.length;n<r;n+=1)t(e[n]);else t(e)},l.prototype.on=function(e,t){var n=this,r=e.split(/[ ,]+/g),i;n._handlers_=n._handlers_||{};for(var s=0;s<r.length;s+=1)i=r[s],n._handlers_[i]=n._handlers_[i]||[],n._handlers_[i].push(t);return n},l.prototype.off=function(e,t){var n=this;return n._handlers_=n._handlers_||{},e===undefined?n._handlers_={}:t===undefined?n._handlers_[e]=null:n._handlers_[e]&&n._handlers_[e].indexOf(t)>=0&&n._handlers_[e].splice(n._handlers_[e].indexOf(t),1),n},l.prototype.trigger=function(e,t){var n=this,r=e.split(/[ ,]+/g),i;n._handlers_=n._handlers_||{};for(var s=0;s<r.length;s+=1)i=r[s],n._handlers_[i]&&n._handlers_[i].length&&n._handlers_[i].forEach(function(e){e.call(n,{type:i,target:n},t)})},l.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=f.safeExtend(t.options,e))},l.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){typeof n["on"+t]=="function"?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},f.bindEvt(e,u[t],n._domHandlers_[t]),a[t]&&f.bindEvt(e,a[t],n._domHandlers_[t]),n},l.prototype.unbindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},f.unbindEvt(e,u[t],n._domHandlers_[t]),a[t]&&f.unbindEvt(e,a[t],n._domHandlers_[t]),delete n._domHandlers_[t],this},c.prototype=new l,c.constructor=c,c.id=0,c.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)},c.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=f.getVendorStyle("borderRadius","50%"),n=f.getTransitionStyle("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5"},f.extend(r.el,n),f.extend(r.back,t),f.extend(r.front,t),this.applyStyles(r),this},c.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},c.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)},c.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)},c.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},c.prototype.show=function(e){var t=this;return t.options.dataOnly?t:(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime),t)},c.prototype.hide=function(e){var t=this;return t.options.dataOnly?t:(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var n=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=n,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.restPosition(),t)},c.prototype.restPosition=function(e){var t=this;t.frontPosition={x:0,y:0};var n=t.options.fadeTime+"ms",r={};r.front=f.getTransitionStyle("transition",["top","left"],n);var i={front:{}};i.front={left:t.frontPosition.x+"px",top:t.frontPosition.y+"px"},t.applyStyles(r),t.applyStyles(i),t.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(t),t.restCallback()},t.options.fadeTime)},c.prototype.restCallback=function(){var e=this,t={};t.front=f.getTransitionStyle("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)},c.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},c.prototype.computeDirection=function(e){var t=e.angle.radian,n=Math.PI/4,r=Math.PI/2,i,s,o;t>n&&t<n*3?i="up":t>-n&&t<=n?i="left":t>-n*3&&t<=-n?i="down":i="right",t>-r&&t<r?s="left":s="right",t>0?o="up":o="down";if(e.force>this.options.threshold){var u={};for(var a in this.direction)this.direction.hasOwnProperty(a)&&(u[a]=this.direction[a]);var f={};this.direction={x:s,y:o,angle:i},e.direction=this.direction;for(var a in u)u[a]===this.direction[a]&&(f[a]=!0);if(f.x&&f.y&&f.angle)return e;(!f.x||!f.y)&&this.trigger("plain",e),f.x||this.trigger("plain:"+s,e),f.y||this.trigger("plain:"+o,e),f.angle||this.trigger("dir dir:"+i,e)}return e},h.prototype=new l,h.constructor=h,h.id=0,h.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(e){if(e===undefined)return t[0];for(var n=0,r=t.length;n<r;n+=1)if(t[n].identifier===e)return t[n];return!1}},h.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},h.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var n=e.createNipple(t.position,e.manager.getIdentifier());n.add(),e.idles.push(n)}},h.prototype.createNipple=function(e,t){var n=this,r=f.getScroll(),i={},s=n.options;if(e.x&&e.y)i={x:e.x-(r.x+n.box.left),y:e.y-(r.y+n.box.top)};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var u=o.getBoundingClientRect();s.zone.removeChild(o),i=e,e={x:u.left+r.x,y:u.top+r.y}}var a=new c(n,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0}});return s.dataOnly||(f.applyPosition(a.ui.el,i),f.applyPosition(a.ui.front,a.frontPosition)),n.nipples.push(a),n.trigger("added "+a.identifier+":added",a),n.manager.trigger("added "+a.identifier+":added",a),n.bindNipple(a),a},h.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()},h.prototype.bindNipple=function(e){var t=this,n,r=function(e,r){n=e.type+" "+r.id+":"+e.type,t.trigger(n,r)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)},h.prototype.pressureFn=function(e,t,n){var r=this,i=0;clearInterval(r.pressureIntervals[n]),r.pressureIntervals[n]=setInterval(function(){var n=e.force||e.pressure||e.webkitForce||0;n!==i&&(t.trigger("pressure",n),r.trigger("pressure "+t.identifier+":pressure",n),i=n)}.bind(r),100)},h.prototype.onstart=function(e){var t=this,n=t.options;e=f.prepareEvent(e),t.updateBox();var r=function(e){t.actives.length<n.maxNumberOfNipples&&t.processOnStart(e)};return f.map(e,r),t.manager.bindDocument(),!1},h.prototype.processOnStart=function(e){var t=this,n=t.options,r,i=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,o={x:e.pageX,y:e.pageY},u=t.getOrCreate(i,o);u.identifier=i;var a=function(n){n.trigger("start",n),t.trigger("start "+n.id+":start",n),n.show(),s>0&&t.pressureFn(e,n,n.identifier),t.processOnMove(e)};(r=t.idles.indexOf(u))>=0&&t.idles.splice(r,1),t.actives.push(u),t.ids.push(u.identifier);if(n.mode!=="semi")a(u);else{var l=f.distance(o,u.position);if(!(l<=n.catchDistance)){u.destroy(),t.processOnStart(e);return}a(u)}return u},h.prototype.getOrCreate=function(e,t){var n=this,r=n.options,i;return/(semi|static)/.test(r.mode)?(i=n.idles[0],i?(n.idles.splice(0,1),i):r.mode==="semi"?n.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(i=n.createNipple(t,e),i)},h.prototype.processOnMove=function(e){var t=this,n=t.options,r=t.manager.getIdentifier(e),i=t.nipples.get(r);if(!i){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}i.identifier=r;var s=i.options.size/2,o={x:e.pageX,y:e.pageY},u=f.distance(o,i.position),a=f.angle(o,i.position),l=f.radians(a),c=u/s;u>s&&(u=s,o=f.findCoord(i.position,u,a)),i.frontPosition={x:o.x-i.position.x,y:o.y-i.position.y},n.dataOnly||f.applyPosition(i.ui.front,i.frontPosition);var h={identifier:i.identifier,position:o,force:c,pressure:e.force||e.pressure||e.webkitForce||0,distance:u,angle:{radian:l,degree:a},instance:i};h=i.computeDirection(h),h.angle={radian:f.radians(180-a),degree:180-a},i.trigger("move",h),t.trigger("move "+i.id+":move",h)},h.prototype.processOnEnd=function(e){var t=this,n=t.options,r=t.manager.getIdentifier(e),i=t.nipples.get(r),s=t.manager.removeIdentifier(i.identifier);if(!i)return;n.dataOnly||i.hide(function(){n.mode==="dynamic"&&(i.trigger("removed",i),t.trigger("removed "+i.id+":removed",i),t.manager.trigger("removed "+i.id+":removed",i),i.destroy())}),clearInterval(t.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),t.trigger("end "+i.id+":end",i),t.ids.indexOf(i.identifier)>=0&&t.ids.splice(t.ids.indexOf(i.identifier),1),t.actives.indexOf(i)>=0&&t.actives.splice(t.actives.indexOf(i),1),/(semi|static)/.test(n.mode)?t.idles.push(i):t.nipples.indexOf(i)>=0&&t.nipples.splice(t.nipples.indexOf(i),1),t.manager.unbindDocument(!0),/(semi|static)/.test(n.mode)&&(t.manager.ids[s.id]=s.identifier)},h.prototype.onDestroyed=function(e,t){var n=this;n.nipples.indexOf(t)>=0&&n.nipples.splice(n.nipples.indexOf(t),1),n.actives.indexOf(t)>=0&&n.actives.splice(n.actives.indexOf(t),1),n.idles.indexOf(t)>=0&&n.idles.splice(n.idles.indexOf(t),1),n.ids.indexOf(t.identifier)>=0&&n.ids.splice(n.ids.indexOf(t.identifier),1),n.manager.removeIdentifier(t.identifier),n.manager.unbindDocument(!0)},h.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(e){e.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(!0),e.off()},p.prototype=new l,p.constructor=p,p.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every(function(e){return(n=e.get(t))?!1:!0}),n}},p.prototype.create=function(e){return this.createCollection(e)},p.prototype.createCollection=function(e){var t=this,n=new h(t,e);return t.bindCollection(n),t.collections.push(n),n},p.prototype.bindCollection=function(e){var t=this,n,r=function(e,r){n=e.type+" "+r.id+":"+e.type,t.trigger(n,r)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)},p.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},p.prototype.unbindDocument=function(e){var t=this;if(!Object.keys(t.ids).length||e===!0)t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1},p.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===undefined?e.pointerId:e.identifier,t===undefined&&(t=this.latest||0)):t=this.index,this.ids[t]===undefined&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},p.prototype.removeIdentifier=function(e){var t={};for(var n in this.ids)if(this.ids[n]===e){t.id=n,t.identifier=this.ids[n],delete this.ids[n];break}return t},p.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1},p.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1},p.prototype.onAny=function(e,t){var n=this,r,i="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=f.prepareEvent(t);var s=function(e,t,n){n.ids.indexOf(t)>=0&&(n[i](e),e._found_=!0)},o=function(e){r=n.getIdentifier(e),f.map(n.collections,s.bind(null,e,r)),e._found_||n.removeIdentifier(r)};return f.map(t,o),!1},p.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(e){e.destroy()}),e.off()},p.prototype.onDestroyed=function(e,t){var n=this;if(n.collections.indexOf(t)<0)return!1;n.collections.splice(n.collections.indexOf(t),1)};var d=new p;return{create:function(e){return d.create(e)},factory:d}});